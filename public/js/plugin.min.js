var $selectedBook=0;var $shippingAddress=null;var $defaultShipping={stairway:"A",lastName:"Doe",prefix:"Dr.",firstName:"John",street:"Teszt utca",type:"Private",comment:"",city:"Budapest",postalCode:"1234",streetNumber:"32.",floor:"2",taxNumber:"10203040",countryCode:"HU",door:"5",companyName:"Test Inc."};var $cListTemplate;var $cDetailsTemplate;var $cSummaryTemplate;var app=new Framework7({root:"#app",name:"My App",id:"com.myapp.test",panel:{swipe:"left"},routes:[{name:"booklist",path:"/booklist/",page:"booklist",url:"/",on:{pageInit:function(c,b){var a=$cListTemplate({books:books});$$(".list-template").html(a)}}},{name:"bookdetails",path:"/bookdetails/",url:"/bookdetails.html",on:{pageInit:function(c,b){if($selectedBook>0){var d=books[$selectedBook-1];var a=$cDetailsTemplate(d);$$(".book-template").html(a)}}}},{name:"summary",path:"/summary/",url:"/summary.html",on:{pageInit:function(d,c){if($selectedBook>0&&$shippingAddress!=null){var f=books[$selectedBook-1];var a={book:f,shipping:$shippingAddress};var b=$cSummaryTemplate(a);$$(".summary-template").html(b)}}}},{path:"/done/",url:"/done.html"},{path:"/failed/",url:"/failed.html"},{path:"/redirect",url:"/redirect.html",on:{pageInit:function(c,b){var a=b.route.query;getPaymentState(a.paymentId)}}}],navbar:{hideOnPageScroll:false,iosCenterTitle:true},statusbar:{enabled:true,overlay:true,iosOverlaysWebView:false,iosBackgroundColor:"#0097DB",materialBackgroundColor:"#0097DB"}});var $$=Dom7;var barionMarket=new BarionMarket();var mainView=app.views.create(".view-main");mainView.router.allowPageChange=true;app.statusbar.setIosTextColor("white");app.statusbar.setBackgroundColor("#0097DB");app.on("init",function(){if($$("html.device-ios").length>0){$$("body").scrollTop(20);$$(".view").scrollTop(20)}else{app.statusbar.hide();$$("body").scrollTop(20);$$(".view").scrollTop(20)}});$$(document).on("DOMContentLoaded",function(){var a=$$("script#listTemplate").html();$cListTemplate=Template7.compile(a);var d=$$("script#detailsTemplate").html();$cDetailsTemplate=Template7.compile(d);var c=$$("script#summaryTemplate").html();$cSummaryTemplate=Template7.compile(c);var b=$cListTemplate({books:books});$$(".list-template").html(b);if($$("html.device-ios").length>0){$$("body").scrollTop(20);$$(".view").scrollTop(20)}else{app.statusbar.hide();$$("body").scrollTop(20);$$(".view").scrollTop(20)}$$(document).on("click","#payWithBarionButton",getPaymentId);$$(document).on("click","#setShippingButton",barionMarket.getShippingAddress);$$(document).on("click","#resultButton",barionMarket.closePlugin);$$(document).on("click","#exitButton",barionMarket.closePlugin);$$(document).on("click","#changeAddressButton",barionMarket.selectAddress);$$(document).on("click",".book-list-item",function(){var e=$$(this).find(".card");e.addClass("touched");$selectedBook=$$(this).attr("data-book-id");mainView.router.navigate("/bookdetails/")});$$(document).on("click",".backToList-link",function(f){f.preventDefault();f.stopPropagation();mainView.router.back("/booklist/",{force:true})});$$(document).on("click",".backToDetails-link",function(f){f.preventDefault();f.stopPropagation();mainView.router.back("/bookdetails/",{force:true})});$$(document).on("click",".book-link",function(){$selectedBook=$$(this).attr("data-book-id")});$$(document).on("click",".navbar, .statusbar",function(f){f.preventDefault();f.stopPropagation();return false})});function getPaymentState(a){app.request({method:"GET",url:"/getpaymentstate?paymentId="+a,error:function(d,b,c){alert("ERROR: "+c+"\r\nStatus: "+b)},success:function(c,b,d){if(c.status=="Succeeded"){mainView.router.load("done.html")}else{mainView.router.load("failed.html")}},complete:function(){$$("#payWithBarionButton").removeClass("disabled").removeAttr("disabled")}})}function getPaymentId(){$$("#payWithBarionButton").addClass("disabled").attr("disabled","disabled");var a=books[$selectedBook-1];app.request({method:"POST",url:"/genpayment",data:{bookAuthor:a.bookAuthor,bookTitle:a.bookTitle,bookISBN:a.bookISBN,bookPublisher:a.bookPublisher,bookPrice:a.bookPrice},dataType:"json",error:function(d,b,c){alert("ERROR: "+c+"\r\nStatus: "+b)},success:function(c,b,d){if(b==200){$$(".page-content").addClass("fading-out");redirectToBarionPaymentGateway(c.paymentId)}else{alert("Request finished with status code '"+b+"', could not process response.")}},complete:function(){$$("#payWithBarionButton").removeClass("disabled").removeAttr("disabled")}})}function redirectToBarionPaymentGateway(a){window.location.href="https://test.barion.com/pay?id="+a}function clearShippingAddress(){$shippingAddress=null;mainView.router.back("/bookdetails/",{force:true})}function setShippingAddress(b){if(typeof b!="undefined"&&b!=null){console.log(b);var c=JSON.parse(b);$shippingAddress={countryCode:c.address.countryCode,city:c.address.city,street:c.address.street,streetNumber:c.address.streetNumber,postalCode:c.address.postalCode,firstName:c.name.firstName,lastName:c.name.lastName,companyName:c.name.companyName}}else{$shippingAddress=$defaultShipping}if($selectedBook>0&&$shippingAddress!=null){var e=books[$selectedBook-1];var a={book:e,shipping:$shippingAddress};var d=$cSummaryTemplate(a);$$(".summary-template").html(d)}}function successfulPaymentCallback(a){window.location.href="/done.html"}function unSuccessfulPaymentCallback(a){window.location.href="/failed.html"};